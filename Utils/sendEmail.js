var moment          = require('moment');
var nodemailer      = require('nodemailer');


module.exports = {
    send: async  function( req, res,param) {
        
        console.log(process.env.EMAIL_SERVICE)
        console.log(process.env.EMAIL_PORT)
        console.log(process.env.EMAIL_USERNAME)
        console.log(process.env.EMAIL_PASSWORD)
        var transporter = nodemailer.createTransport({
            host: process.env.EMAIL_SERVICE,
            port: process.env.EMAIL_PORT,
            secure: false,
            requireTLS: true,
            auth: {
                user: process.env.EMAIL_USERNAME,
                pass: process.env.EMAIL_PASSWORD
            }
        });

        var bodyEmail="<html><body class='clean-body' style='margin:0;padding:0;-webkit-text-size-adjust:100%;background-color:#fff'><table bgcolor='#FFFFFF' cellpadding='0' cellspacing='0' class='nl-container' role='presentation' style='table-layout:fixed;vertical-align:top;min-width:320px;border-spacing:0;border-collapse:collapse;mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;width:100%' valign='top' width='100%'><tbody><tr style='vertical-align:top' valign='top'><td style='word-break:break-word;vertical-align:top' valign='top'><div style='background-color:transparent'><div class='block-grid' style='min-width:320px;max-width:640px;overflow-wrap:break-word;word-wrap:break-word;word-break:break-word;Margin:0 auto;background-color:transparent'><div style='border-collapse:collapse;display:table;width:100%;background-color:transparent'><div class='col num12' style='min-width:320px;max-width:640px;display:table-cell;vertical-align:top;width:640px'><div class='col_cont' style='width:100%!important'><div style='border-top:0 solid transparent;border-left:0 solid transparent;border-bottom:0 solid transparent;border-right:0 solid transparent;padding-top:5px;padding-bottom:5px;padding-right:0;padding-left:0'><table border='0' cellpadding='0' cellspacing='0' class='divider' role='presentation' style='table-layout:fixed;vertical-align:top;border-spacing:0;border-collapse:collapse;mso-table-lspace:0;mso-table-rspace:0;min-width:100%;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%' valign='top' width='100%'><tbody><tr style='vertical-align:top' valign='top'><td class='divider_inner' style='word-break:break-word;vertical-align:top;min-width:100%;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;padding-top:10px;padding-right:10px;padding-bottom:10px;padding-left:10px' valign='top'><table align='center' border='0' cellpadding='0' cellspacing='0' class='divider_content' role='presentation' style='table-layout:fixed;vertical-align:top;border-spacing:0;border-collapse:collapse;mso-table-lspace:0;mso-table-rspace:0;border-top:0 solid #fff;width:100%' valign='top' width='100%'><tbody><tr style='vertical-align:top' valign='top'><td style='word-break:break-word;vertical-align:top;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%' valign='top'><span></span></td></tr></tbody></table></td></tr></tbody></table></div></div></div></div></div></div><div style='background-color:transparent'><div class='block-grid three-up' style='min-width:320px;max-width:640px;height:70.8px;overflow-wrap:break-word;word-wrap:break-word;word-break:break-word;Margin:0 auto;background-color:#8cc0e8'><div style='border-collapse:collapse;display:table;width:100%;background-color:#385898'><div class='col num4' style='display:table-cell;vertical-align:top;max-width:320px;min-width:212px;width:213px'><div class='col_cont' style='width:100%!important'><div style='border-top:0 solid transparent;border-left:0 solid transparent;border-bottom:0 solid transparent;border-right:0 solid transparent;padding-top:15px;padding-bottom:15px;padding-right:0;padding-left:0'><div style='color:#fff;font-family:Lato,Tahoma,Verdana,Segoe,sans-serif;line-height:1.5;padding-top:15px;padding-right:10px;padding-bottom:10px;padding-left:10px'><div style='font-size:15px;line-height:1.5;color:#fff;font-family:Lato,Tahoma,Verdana,Segoe,sans-serif;mso-line-height-alt:21px;text-align:center'><strong>Informasi Akun Pengguna</strong><br></div></div></div></div></div></div></div></div><div style='background-color:transparent'><div class='block-grid four-up no-stack' style='min-width:320px;max-width:640px;overflow-wrap:break-word;word-wrap:break-word;word-break:break-word;Margin:0 auto;background-color:#5c98c7'><div style='border-collapse:collapse;display:table;width:100%;background-color:#f2f3fa'><div class='col num3' style='display:table-cell;vertical-align:top;max-width:320px;min-width:159px;width:160px'><div class='col_cont' style='width:100%!important'><div style='border-top:0 solid transparent;border-left:0 solid transparent;border-right:0 solid transparent;padding-top:5px;padding-bottom:5px;padding-right:0;padding-left:0'><div style='color:#fff;font-family:Lato,Tahoma,Verdana,Segoe,sans-serif;line-height:1.2;padding-top:10px;padding-right:10px;padding-bottom:10px;padding-left:40px'><div style='font-size:14px;line-height:1.2;color:#385898;font-family:Lato,Tahoma,Verdana,Segoe,sans-serif;mso-line-height-alt:17px'><p style='font-size:14px;line-height:1.2;word-break:break-word;text-align:left;mso-line-height-alt:17px;margin:0'>Nama Lengkap</p></div></div></div></div></div><div class='col num3' style='display:table-cell;vertical-align:top;max-width:320px;min-width:159px;width:160px'><div class='col_cont' style='width:100%!important'><div style='border-top:0 solid transparent;border-left:0 solid transparent;border-right:0 solid transparent;padding-top:5px;padding-bottom:5px;padding-right:0;padding-left:0'><div style='color:#fff;font-family:Lato,Tahoma,Verdana,Segoe,sans-serif;line-height:1.2;padding-top:10px;padding-right:40px;padding-bottom:10px;padding-left:10px'><div style='font-size:14px;line-height:1.2;color:#000;font-family:Lato,Tahoma,Verdana,Segoe,sans-serif;mso-line-height-alt:17px'><p style='font-size:14px;line-height:1.2;word-break:break-word;text-align:right;mso-line-height-alt:17px;margin:0'>"+param.name+"</p></div></div></div></div></div></div></div></div><div style='background-color:transparent'><div class='block-grid four-up no-stack' style='min-width:320px;max-width:640px;overflow-wrap:break-word;word-wrap:break-word;word-break:break-word;Margin:0 auto;background-color:#5c98c7'><div style='border-collapse:collapse;display:table;width:100%;background-color:#f2f3fa'><div class='col num3' style='display:table-cell;vertical-align:top;max-width:320px;min-width:159px;width:160px'><div class='col_cont' style='width:100%!important'><div style='border-top:0 solid transparent;border-left:0 solid transparent;border-right:0 solid transparent;padding-top:5px;padding-bottom:5px;padding-right:0;padding-left:0'><div style='color:#fff;font-family:Lato,Tahoma,Verdana,Segoe,sans-serif;line-height:1.2;padding-top:10px;padding-right:10px;padding-bottom:10px;padding-left:40px'><div style='font-size:14px;line-height:1.2;color:#385898;font-family:Lato,Tahoma,Verdana,Segoe,sans-serif;mso-line-height-alt:17px'><p style='font-size:14px;line-height:1.2;word-break:break-word;text-align:left;mso-line-height-alt:17px;margin:0'>Alamat E-mail</p></div></div></div></div></div><div class='col num3' style='display:table-cell;vertical-align:top;max-width:320px;min-width:159px;width:160px'><div class='col_cont' style='width:100%!important'><div style='border-top:0 solid transparent;border-left:0 solid transparent;border-right:0 solid transparent;padding-top:5px;padding-bottom:5px;padding-right:0;padding-left:0'><div style='color:#fff;font-family:Lato,Tahoma,Verdana,Segoe,sans-serif;line-height:1.2;padding-top:10px;padding-right:40px;padding-bottom:10px;padding-left:10px'><div style='font-size:14px;line-height:1.2;color:#000;font-family:Lato,Tahoma,Verdana,Segoe,sans-serif;mso-line-height-alt:17px'><p style='font-size:14px;line-height:1.2;word-break:break-word;text-align:right;mso-line-height-alt:17px;margin:0'>"+param.email+"</p></div></div></div></div></div></div></div></div><div style='background-color:transparent'><div class='block-grid four-up no-stack' style='min-width:320px;max-width:640px;overflow-wrap:break-word;word-wrap:break-word;word-break:break-word;Margin:0 auto;background-color:#6da3cd'><div style='border-collapse:collapse;display:table;width:100%;background-color:#a2b9ed'><div class='col num3' style='display:table-cell;vertical-align:top;max-width:320px;min-width:159px;width:160px'><div class='col_cont' style='width:100%!important'><div style='border-top:0 solid transparent;border-left:0 solid transparent;border-bottom:0 solid transparent;border-right:0 solid transparent;padding-top:5px;padding-bottom:5px;padding-right:0;padding-left:0'><div style='color:#fff;font-family:Lato,Tahoma,Verdana,Segoe,sans-serif;line-height:1.2;padding-top:10px;padding-right:10px;padding-bottom:10px;padding-left:10px'><div style='font-size:14px;line-height:1.2;color:#fff;font-family:Lato,Tahoma,Verdana,Segoe,sans-serif;mso-line-height-alt:17px'><p style='font-size:14px;line-height:1.2;word-break:break-word;text-align:center;mso-line-height-alt:17px;margin:0'><strong>Nama Pengguna & Kata Sandi</strong></p></div></div></div></div></div></div></div></div><div style='background-color:transparent'><div class='block-grid four-up no-stack' style='min-width:320px;max-width:640px;overflow-wrap:break-word;word-wrap:break-word;word-break:break-word;Margin:0 auto;background-color:#5c98c7'><div style='border-collapse:collapse;display:table;width:100%;background-color:#f2f3fa'><div class='col num3' style='display:table-cell;vertical-align:top;max-width:320px;min-width:159px;width:160px'><div class='col_cont' style='width:100%!important'><div style='border-top:0 solid transparent;border-left:0 solid transparent;border-right:0 solid transparent;padding-top:5px;padding-bottom:5px;padding-right:0;padding-left:0'><div style='color:#fff;font-family:Lato,Tahoma,Verdana,Segoe,sans-serif;line-height:1.2;padding-top:10px;padding-right:10px;padding-bottom:10px;padding-left:40px'><div style='font-size:14px;line-height:1.2;color:#385898;font-family:Lato,Tahoma,Verdana,Segoe,sans-serif;mso-line-height-alt:17px'><p style='font-size:14px;line-height:1.2;word-break:break-word;text-align:left;mso-line-height-alt:17px;margin:0'>Nama Pengguna</p></div></div></div></div></div><div class='col num3' style='display:table-cell;vertical-align:top;max-width:320px;min-width:159px;width:160px'><div class='col_cont' style='width:100%!important'><div style='border-top:0 solid transparent;border-left:0 solid transparent;border-right:0 solid transparent;padding-top:5px;padding-bottom:5px;padding-right:0;padding-left:0'><div style='color:#fff;font-family:Lato,Tahoma,Verdana,Segoe,sans-serif;line-height:1.2;padding-top:10px;padding-right:40px;padding-bottom:10px;padding-left:10px'><div style='font-size:14px;line-height:1.2;color:#000;font-family:Lato,Tahoma,Verdana,Segoe,sans-serif;mso-line-height-alt:17px'><p style='font-size:14px;line-height:1.2;word-break:break-word;text-align:right;mso-line-height-alt:17px;margin:0'>"+param.username+"</p></div></div></div></div></div></div></div><div class='block-grid four-up no-stack' style='min-width:320px;max-width:640px;overflow-wrap:break-word;word-wrap:break-word;word-break:break-word;Margin:0 auto;background-color:#5c98c7'><div style='border-collapse:collapse;display:table;width:100%;background-color:#f2f3fa'><div class='col num3' style='display:table-cell;vertical-align:top;max-width:320px;min-width:159px;width:160px'><div class='col_cont' style='width:100%!important'><div style='border-top:0 solid transparent;border-left:0 solid transparent;border-right:0 solid transparent;padding-top:5px;padding-bottom:5px;padding-right:0;padding-left:0'><div style='color:#fff;font-family:Lato,Tahoma,Verdana,Segoe,sans-serif;line-height:1.2;padding-top:10px;padding-right:10px;padding-bottom:10px;padding-left:40px'><div style='font-size:14px;line-height:1.2;color:#385898;font-family:Lato,Tahoma,Verdana,Segoe,sans-serif;mso-line-height-alt:17px'><p style='font-size:14px;line-height:1.2;word-break:break-word;text-align:left;mso-line-height-alt:17px;margin:0'>Password</p></div></div></div></div></div><div class='col num3' style='display:table-cell;vertical-align:top;max-width:320px;min-width:159px;width:160px'><div class='col_cont' style='width:100%!important'><div style='border-top:0 solid transparent;border-left:0 solid transparent;border-right:0 solid transparent;padding-top:5px;padding-bottom:5px;padding-right:0;padding-left:0'><div style='color:#fff;font-family:Lato,Tahoma,Verdana,Segoe,sans-serif;line-height:1.2;padding-top:10px;padding-right:40px;padding-bottom:10px;padding-left:10px'><div style='font-size:14px;line-height:1.2;color:#000;font-family:Lato,Tahoma,Verdana,Segoe,sans-serif;mso-line-height-alt:17px'><p style='font-size:14px;line-height:1.2;word-break:break-word;text-align:right;mso-line-height-alt:17px;margin:0'>"+param.password+"</p></div></div></div></div></div></div></div></div><div style='background-color:transparent'><div class='block-grid four-up no-stack' style='min-width:320px;max-width:640px;overflow-wrap:break-word;word-wrap:break-word;word-break:break-word;Margin:0 auto;background-color:#6da3cd'><div style='border-collapse:collapse;display:table;width:100%;background-color:#f9773b'><div class='col num3' style='display:table-cell;vertical-align:top;max-width:320px;min-width:159px;width:160px'><div class='col_cont' style='width:100%!important'><div style='border-top:0 solid transparent;border-left:0 solid transparent;border-bottom:0 solid transparent;border-right:0 solid transparent;padding-top:5px;padding-bottom:5px;padding-right:0;padding-left:0'><div style='color:#fff;font-family:Lato,Tahoma,Verdana,Segoe,sans-serif;line-height:1.2;padding-top:10px;padding-right:10px;padding-bottom:10px;padding-left:10px'><div style='font-size:14px;line-height:1.2;color:#fff;font-family:Lato;font-style:italic;mso-line-height-alt:17px'><p style='font-size:14px;line-height:1.2;word-break:break-word;text-align:center;mso-line-height-alt:17px;margin:0'><strong>Perhatian!</strong><br>Data nama pengguna dan kata sandi yang tertera diatas bersifat rahasia, pastikan Anda tidak memberitahukan data tersebut kepada pihak yang tidak berhak untuk mengakses akun pengguna Anda demi menghindari hal-hal yang tidak semestinya terjadi.</p></div></div></div></div></div></div></div></div></td></tr></tbody></table></body></html>';";
        var mailOptions = {
            from: process.env.EMAIL_USERNAME,
            to: "devpelangijogja@gmail.com",
            subject: 'Informasi Pendaftaran Akun Pengguna',
            html: bodyEmail
        };

        transporter.sendMail(mailOptions, (err, info) => {
            if (err){
                console.log('*********** error send email ***********')
                console.log(err)
                console.log('************* *********** *************')
            };

            console.log('Email sent to : '+req.body.email)
        });
    }
}
